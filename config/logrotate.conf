# Logrotate configuration for Futarchy Arbitrage Bot
# 
# Installation:
#   sudo cp config/logrotate.conf /etc/logrotate.d/futarchy-arbitrage
#   sudo chmod 644 /etc/logrotate.d/futarchy-arbitrage
#
# Manual rotation test:
#   sudo logrotate -f /etc/logrotate.d/futarchy-arbitrage
#
# Adjust the log path to match your installation directory

/path/to/futarchy-arbitrage-1/logs/*.log {
    # Rotate daily
    daily
    
    # Keep 30 days of logs
    rotate 30
    
    # Compress rotated logs (saves space)
    compress
    
    # Delay compression until next rotation cycle
    # (allows current day's log to remain uncompressed)
    delaycompress
    
    # Don't error if log file is missing
    missingok
    
    # Don't rotate empty log files
    notifempty
    
    # Create new log file with these permissions
    create 0644 www-data www-data
    
    # Use date as suffix instead of numbers
    dateext
    dateformat -%Y-%m-%d
    
    # Share log files between multiple processes
    sharedscripts
    
    # Commands to run after rotation
    postrotate
        # Send HUP signal to bot processes to reopen log files
        # Adjust process name as needed
        killall -HUP python3 2>/dev/null || true
    endscript
}

# Special handling for trade logs (keep longer, no compression)
/path/to/futarchy-arbitrage-1/logs/trades_*.log {
    # Rotate monthly
    monthly
    
    # Keep 12 months of trade logs
    rotate 12
    
    # Don't compress trade logs (for easier auditing)
    nocompress
    
    # Don't error if log file is missing
    missingok
    
    # Don't rotate empty log files
    notifempty
    
    # Create new log file with these permissions
    create 0644 www-data www-data
    
    # Use date as suffix
    dateext
    dateformat -%Y-%m
    
    # Share log files between multiple processes
    sharedscripts
}

# Special handling for error logs (keep longer, max size)
/path/to/futarchy-arbitrage-1/logs/*_errors.log {
    # Rotate daily OR when file reaches 50MB
    daily
    size 50M
    
    # Keep 90 days of error logs
    rotate 90
    
    # Compress rotated logs
    compress
    delaycompress
    
    # Don't error if log file is missing
    missingok
    
    # Don't rotate empty log files
    notifempty
    
    # Create new log file with these permissions
    create 0644 www-data www-data
    
    # Use date as suffix
    dateext
    dateformat -%Y-%m-%d
    
    # Share log files between multiple processes
    sharedscripts
    
    # Send notification on errors
    postrotate
        # Optional: send alert if error log was rotated
        # (means errors occurred)
        if [ -s "$1" ]; then
            echo "Error log rotated: $1" | mail -s "Futarchy Bot Errors" admin@example.com 2>/dev/null || true
        fi
    endscript
}
